<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Digraphs - ey/ie, ay/ai, oy/oi</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --vowel-color: #ff0000;
            --consonant-color: #0000ff;
            --success: #2e7d32;
            --accent: #ff9800;
            --wrong: #f44336;
            --bg-start: #e3f2fd;
            --bg-end: #f3e5f5;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            background: linear-gradient(-45deg, var(--bg-start), #ffffff, var(--bg-end), #fff9c4);
            background-size: 400% 400%;
            animation: gradientBG 10s ease infinite;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #menuView, #gameView {
            width: 95%;
            max-width: 900px;
            padding: 20px;
            text-align: center;
            box-sizing: border-box;
        }

        .hidden { display: none !important; }

        h1 { font-size: clamp(2rem, 8vw, 3.2rem); color: #333; text-shadow: 2px 2px 0 white; margin: 20px 0; }

        .part-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .level-btn {
            padding: 20px 10px;
            font-size: 1.2rem;
            border-radius: 20px;
            border: 3px solid #ddd;
            background: white;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
            box-shadow: 0 5px 0 #ddd;
        }

        .level-btn.active {
            border-color: var(--accent);
            background: #fff3e0;
            color: var(--accent);
            box-shadow: 0 5px 0 var(--accent);
            transform: translateY(-2px);
        }

        .game-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            position: relative;
            min-height: 520px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .single-image {
            width: 220px;
            height: 220px;
            margin-bottom: 20px;
            cursor: pointer;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
        }

        .single-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .word-slot {
            font-size: 4.5rem;
            display: inline-block;
            margin-bottom: 30px;
            font-weight: bold;
            color: #333;
            line-height: 1;
            letter-spacing: -1px;
        }

        .blank-space {
            display: inline-block;
            min-width: 80px;
            border-bottom: 6px solid #333;
            margin: 0 5px;
            color: var(--consonant-color);
            text-align: center;
        }

        .word-complete {
            color: var(--success);
            transform: scale(1.1);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            letter-spacing: 2px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.1);
        }

        .choices-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 650px;
            margin-top: 10px;
        }

        @media (min-width: 600px) {
            .choices-container.hard-mode {
                grid-template-columns: repeat(3, 1fr);
            }
            .choices-container.normal-mode {
                display: flex;
                justify-content: center;
            }
        }

        .choice-btn {
            height: 80px;
            background: white;
            border: 3px solid #eee;
            font-size: 2.2rem;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 6px 0 #ddd;
            transition: all 0.1s;
            color: var(--consonant-color);
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .choice-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #ddd; }

        .btn-action {
            background: var(--success);
            color: white;
            padding: 18px 60px;
            font-size: 1.8rem;
            border-radius: 100px;
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 0 #1b5e20;
            font-weight: bold;
            margin-top: 15px;
        }

        #toast {
            position: absolute; top: 15px; left: 50%; transform: translateX(-50%);
            background: var(--accent); color: white; padding: 10px 30px;
            border-radius: 50px; font-size: 1.5rem; opacity: 0; transition: 0.3s;
            z-index: 10; font-weight: bold; pointer-events: none;
        }
        #toast.show { opacity: 1; top: 25px; }

        @media (max-width: 600px) {
            .word-slot { font-size: 3rem; }
            .blank-space { min-width: 50px; border-bottom-width: 4px; }
            .choice-btn { height: 70px; font-size: 1.8rem; }
            .single-image { width: 180px; height: 180px; }
        }
    </style>
</head>
<body>

    <div id="menuView">
        <h1>üéØ Digraphs - ey/ie, ay/ai, oy/oi</h1>
        <p style="font-size: 1.3rem; color: #555;">Choose the missing letters!</p>
        
        <div class="part-selector">
            <button class="level-btn active" onclick="setPart(1, this)">Part 1<br>(ey / ie)</button>
            <button class="level-btn" onclick="setPart(2, this)">Part 2<br>(ay / ai)</button>
            <button class="level-btn" onclick="setPart(3, this)">Part 3<br>(oy / oi)</button>
            <button class="level-btn" onclick="setPart(4, this)" style="border-color: #ff5252; color: #ff5252;">Part 4<br>üî• ULTRA MIX</button>
        </div>

        <button class="btn-action" onclick="startGame()">Go! üöÄ</button>
    </div>

    <div id="gameView" class="hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; width: 100%;">
            <button onclick="showMenu()" style="background:none; border:none; color:#666; font-weight:bold; cursor:pointer; font-size: 1.1rem;">‚Üê Menu</button>
            <div id="progressText" style="background:white; padding:8px 25px; border-radius:20px; font-weight:bold; box-shadow: 0 4px 0 #ddd;">1 / 15</div>
        </div>
        
        <div class="game-card">
            <div id="toast">Excellent! ‚ú®</div>
            <div class="single-image" onclick="speakWord(currentQuestion.display)">
                <img id="gameImg" src="" alt="word">
            </div>
            <div id="wordContainer" class="word-slot"></div>
            <div id="interactionArea" style="width: 100%; display: flex; justify-content: center;"></div>
            <button id="nextBtn" class="btn-action hidden" onclick="nextQuestion()">Next Word! ‚Üí</button>
        </div>
    </div>

    <script>
        const imageFolder = "images-ey-ei-ay-ai-oy-oi/";
        
        const wordData = {
            p1: [
                { display: 'money', target: 'ey', img: 'money' },
                { display: 'key', target: 'ey', img: 'key' },
                { display: 'monkey', target: 'ey', img: 'monkey' },
                { display: 'kidney', target: 'ey', img: 'kidney' },
                { display: 'turkey', target: 'ey', img: 'turkey' },
                { display: 'honey', target: 'ey', img: 'honey' },
                { display: 'field', target: 'ie', img: 'field' },
                { display: 'shield', target: 'ie', img: 'shield' },
                { display: 'thief', target: 'ie', img: 'thief' },
                { display: 'a piece', target: 'ie', img: 'a-piece' },
                { display: 'movie', target: 'ie', img: 'movie' },
                { display: 'priest', target: 'ie', img: 'priest' }
            ],
            p2: [
                { display: 'tray', target: 'ay', img: 'tray' },
                { display: 'play', target: 'ay', img: 'play' },
                { display: 'spray', target: 'ay', img: 'spray' },
                { display: 'pay', target: 'ay', img: 'pay' },
                { display: 'pray', target: 'ay', img: 'pray' },
                { display: 'clay', target: 'ay', img: 'clay' },
                { display: 'brain', target: 'ai', img: 'brain' },
                { display: 'train', target: 'ai', img: 'train' },
                { display: 'snail', target: 'ai', img: 'snail' },
                { display: 'pail', target: 'ai', img: 'pail' }
            ],
            p3: [
                { display: 'joy', target: 'oy', img: 'joy' },
                { display: 'toys', target: 'oy', img: 'toys' },
                { display: 'boy', target: 'oy', img: 'boy' },
                { display: 'destroy', target: 'oy', img: 'destroy' },
                { display: 'oyster', target: 'oy', img: 'oyster' },
                { display: 'annoy', target: 'oy', img: 'annoy' },
                { display: 'oil', target: 'oi', img: 'oil' },
                { display: 'boil', target: 'oi', img: 'boil' },
                { display: 'coil', target: 'oi', img: 'coil' },
                { display: 'coins', target: 'oi', img: 'coins' },
                { display: 'point', target: 'oi', img: 'point' },
                { display: 'soil', target: 'oi', img: 'soil' }
            ]
        };

        // --- Voice Logic ---
        let preferredVoice = null;
        function loadVoices() {
            const voices = window.speechSynthesis.getVoices();
            const femaleVoiceNames = ["Google US English", "Samantha", "Microsoft Zira", "Victoria"];
            for (let name of femaleVoiceNames) {
                preferredVoice = voices.find(v => v.name.includes(name) && v.lang.startsWith("en"));
                if (preferredVoice) break;
            }
            if (!preferredVoice) preferredVoice = voices.find(v => v.lang.startsWith("en"));
        }
        window.speechSynthesis.onvoiceschanged = loadVoices;
        loadVoices();

        function speakWord(text) {
            window.speechSynthesis.cancel();
            const uttr = new SpeechSynthesisUtterance(text);
            if (preferredVoice) uttr.voice = preferredVoice;
            uttr.lang = "en-US";
            uttr.rate = 0.9;
            uttr.pitch = 1.0;
            window.speechSynthesis.speak(uttr);
        }
        // ------------------

        let currentPart = 1;
        let gameQueue = [];
        let currentQuestion = null;
        let totalQuestions = 0;
        const praise = ["Fantastic!", "You Got It!", "Super!", "Well Done!", "Perfect!"];

        function setPart(part, btn) {
            currentPart = part;
            document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

        function startGame() {
            gameQueue = [];
            if (currentPart === 4) {
                const p1_sel = shuffle([...wordData.p1]).slice(0, 5);
                const p2_sel = shuffle([...wordData.p2]).slice(0, 5);
                const p3_sel = shuffle([...wordData.p3]).slice(0, 5);
                gameQueue = shuffle([...p1_sel, ...p2_sel, ...p3_sel]);
                totalQuestions = 15;
            } else {
                const source = [...wordData['p' + currentPart]];
                gameQueue = shuffle([...source]);
                totalQuestions = source.length;
            }
            document.getElementById('menuView').classList.add('hidden');
            document.getElementById('gameView').classList.remove('hidden');
            nextQuestion();
        }

        function nextQuestion() {
            if (gameQueue.length === 0) { finish(); return; }
            currentQuestion = gameQueue.pop();
            const currentCount = totalQuestions - gameQueue.length;
            document.getElementById('progressText').textContent = `${currentCount} / ${totalQuestions}`;
            document.getElementById('gameImg').src = `${imageFolder}${currentQuestion.img}.jpg`;
            document.getElementById('nextBtn').classList.add('hidden');
            document.getElementById('toast').classList.remove('show');
            const container = document.getElementById('wordContainer');
            container.classList.remove('word-complete');
            const parts = currentQuestion.display.split(currentQuestion.target);
            container.innerHTML = `${parts[0]}<span class="blank-space">?</span>${parts[1]}`;
            renderChoices();
        }

        function renderChoices() {
            const area = document.getElementById('interactionArea');
            area.innerHTML = '';
            const choicesContainer = document.createElement('div');
            choicesContainer.className = 'choices-container ' + (currentPart === 4 ? 'hard-mode' : 'normal-mode');
            let choices = [];
            if (currentPart === 4) {
                choices = ['ey', 'ie', 'ay', 'ai', 'oy', 'oi'];
            } else {
                const pairs = [['ey', 'ie'], ['ay', 'ai'], ['oy', 'oi']];
                choices = pairs.find(p => p.includes(currentQuestion.target));
            }
            shuffle([...choices]).forEach(c => {
                const btn = document.createElement('div');
                btn.className = 'choice-btn';
                if (currentPart !== 4) btn.style.width = "140px";
                btn.textContent = c;
                btn.onclick = () => checkAnswer(c);
                choicesContainer.appendChild(btn);
            });
            area.appendChild(choicesContainer);
        }

        function checkAnswer(selected) {
            if (selected === currentQuestion.target) {
                const container = document.getElementById('wordContainer');
                container.innerHTML = currentQuestion.display;
                container.classList.add('word-complete');
                document.getElementById('interactionArea').innerHTML = '';
                const toast = document.getElementById('toast');
                toast.textContent = praise[Math.floor(Math.random() * praise.length)];
                toast.classList.add('show');
                document.getElementById('nextBtn').classList.remove('hidden');
                speakWord(currentQuestion.display);
                confetti({ particleCount: 60, spread: 80, origin: { y: 0.7 } });
            } else { speakWord("Try again"); }
        }

        function finish() {
            confetti({ particleCount: 250, spread: 120, origin: { y: 0.5 } });
            setTimeout(() => { alert("üèÜ You are a Phonics Champion!"); showMenu(); }, 1000);
        }

        function showMenu() {
            document.getElementById('gameView').classList.add('hidden');
            document.getElementById('menuView').classList.remove('hidden');
        }
    </script>
</body>
</html>